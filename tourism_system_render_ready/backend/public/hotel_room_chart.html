
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø´Ø§Ø±Øª Ø§Ù„ØºØ±Ù - Ø§Ù„ÙÙ†Ø§Ø¯Ù‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f9f9f9; padding: 30px; text-align: center; }
    .filters { margin-bottom: 20px; }
    .filters select, .filters input { padding: 5px; font-size: 16px; margin-left: 10px; }
    .room-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
    .room { width: 80px; height: 80px; border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 14px; cursor: pointer; box-shadow: 0 0 4px rgba(0,0,0,0.2); }
    .available { background-color: #28a745; color: white; }
    .reserved { background-color: #dc3545; color: white; }
    #roomInfo { margin-top: 30px; display: none; text-align: right; background: #fff; padding: 20px;
                border-radius: 10px; box-shadow: 0 0 10px #ccc; max-width: 500px; margin-inline: auto; }
  </style>
</head>
<body>
  <h3>ğŸ¨ Ø´Ø§Ø±Øª Ø§Ù„ØºØ±Ù - Ø§Ù„ÙÙ†Ø§Ø¯Ù‚</h3>

  <div class="filters">
    <label>Ø§Ø®ØªØ± Ø§Ù„ÙÙ†Ø¯Ù‚:</label>
    <select id="hotelSelect"></select>
    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
    <input type="date" id="selectedDate" />
    <button onclick="loadRooms()">Ø¹Ø±Ø¶</button>
  </div>

  <div class="room-grid" id="roomGrid"></div>

  <div id="roomInfo">
    <h5>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºØ±ÙØ© / Ø§Ù„Ø­Ø¬Ø²</h5>
    <p id="infoRoom">ğŸ  Ø§Ù„ØºØ±ÙØ©: </p>
    <p id="infoType">ğŸ›ï¸ Ø§Ù„Ù†ÙˆØ¹: </p>
    <p id="infoStatus">ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø©: </p>
    <p id="infoCustomer">ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: </p>
    <p id="infoDate">ğŸ“… Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®: </p>
    <button class="btn btn-warning" onclick="editRoom()">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    <button class="btn btn-danger" onclick="deleteBooking()">ğŸ—‘ Ø­Ø°Ù</button>
  </div>

<script>
let roomData = [];
let selectedRoom = null;

function loadHotels() {
  fetch('/api/hotels')
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById("hotelSelect");
      select.innerHTML = "";
      data.forEach(h => {
        const option = document.createElement("option");
        option.value = h._id;
        option.text = h.name;
        select.appendChild(option);
      });
    });
}

function loadRooms() {
  const hotelId = document.getElementById("hotelSelect").value;
  const date = document.getElementById("selectedDate").value;
  if (!hotelId || !date) return alert("ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙÙ†Ø¯Ù‚ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®");

  fetch(`/api/room-chart?hotelId=${hotelId}&date=${date}`)
    .then(res => res.json())
    .then(data => {
      roomData = data;
      renderRooms();
    });
}

function renderRooms() {
  const grid = document.getElementById("roomGrid");
  grid.innerHTML = "";
  roomData.forEach(room => {
    const div = document.createElement("div");
    div.className = "room " + (room.booked ? "reserved" : "available");
    div.innerText = room.number;
    div.onclick = () => handleRoomClick(room);
    grid.appendChild(div);
  });
}

function handleRoomClick(room) {
  selectedRoom = room;
  document.getElementById("roomInfo").style.display = "block";
  document.getElementById("infoRoom").innerText = "ğŸ  Ø§Ù„ØºØ±ÙØ©: " + room.number;
  document.getElementById("infoType").innerText = "ğŸ›ï¸ Ø§Ù„Ù†ÙˆØ¹: " + (room.type || "--");
  document.getElementById("infoStatus").innerText = "ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø©: " + (room.booked ? "Ù…Ø­Ø¬ÙˆØ²Ø©" : "Ù…ØªØ§Ø­Ø©");
  document.getElementById("infoCustomer").innerText = "ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: " + (room.customer?.name || "--");
  document.getElementById("infoDate").innerText = "ğŸ“… Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®: " + (room.checkIn || "--") + " Ø¥Ù„Ù‰ " + (room.checkOut || "--");
}

function editRoom() {
  if (!selectedRoom || !selectedRoom.booked) return;
  window.location.href = "/edit_invoice.html?id=" + selectedRoom.bookingId;
}

function deleteBooking() {
  if (!selectedRoom || !selectedRoom.bookingId) return;
  if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ")) return;
  fetch("/api/reservations/" + selectedRoom.bookingId, { method: "DELETE" })
    .then(() => {
      alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²");
      loadRooms();
      document.getElementById("roomInfo").style.display = "none";
    });
}

window.onload = loadHotels;
</script>
</body>
</html>
