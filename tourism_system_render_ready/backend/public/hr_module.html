
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© HR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Cairo', sans-serif; padding: 30px; background: #f7f7f7; text-align: center; }
    h2 { margin-bottom: 25px; }
    .section { background: white; margin-bottom: 30px; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    .section h3 { margin-bottom: 15px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #eee; }
    form input, form select, form button {
      padding: 8px; margin: 5px 0; width: 100%; max-width: 300px;
    }
  </style>
</head>
<body>

  <h2>ğŸ§‘â€ğŸ’¼ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© HR</h2>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± -->
  <div class="section">
    <h3>ğŸ“Œ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
    <form id="attendanceForm">
      <select id="employeeSelect"></select>
      <input type="date" id="attendanceDate" required />
      <select id="statusSelect">
        <option value="Ø­Ø¶ÙˆØ±">Ø­Ø¶ÙˆØ±</option>
        <option value="ØºÙŠØ§Ø¨">ØºÙŠØ§Ø¨</option>
      </select>
      <button type="submit">ğŸ’¾ ØªØ³Ø¬ÙŠÙ„</button>
    </form>
    <table><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody id="attendanceTable"></tbody></table>
  </div>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
  <div class="section">
    <h3>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
    <form id="employeeForm">
      <input type="text" id="empName" placeholder="Ø§Ù„Ø§Ø³Ù…" required />
      <input type="text" id="empJob" placeholder="Ø§Ù„ÙˆØ¸ÙŠÙØ©" required />
      <input type="number" id="empSalary" placeholder="Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ" required />
      <button type="submit">â• Ø¥Ø¶Ø§ÙØ©</button>
    </form>
    <table><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th><th>Ø§Ù„Ø±Ø§ØªØ¨</th><th>ğŸ—‘</th></tr></thead><tbody id="employeeTable"></tbody></table>
  </div>

  <!-- Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª -->
  <div class="section">
    <h3>ğŸ’¼ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</h3>
    <form id="commissionForm">
      <select id="commissionEmployee"></select>
      <input type="number" id="commissionAmount" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©" required />
      <input type="date" id="commissionDate" required />
      <button type="submit">â• ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…ÙˆÙ„Ø©</button>
    </form>
    <table><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead><tbody id="commissionTable"></tbody></table>
  </div>

  <!-- Ø§Ù„Ø±ÙˆØ§ØªØ¨ -->
  <div class="section">
    <h3>ğŸ’° Ø§Ù„Ø±ÙˆØ§ØªØ¨</h3>
    <button onclick="calculateSalaries()">ğŸ“Š Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ÙˆØ§ØªØ¨</button>
    <table><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ø±Ø§ØªØ¨</th><th>Ø§Ù„Ø­Ø¶ÙˆØ±</th><th>Ø§Ù„ØºÙŠØ§Ø¨</th><th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead><tbody id="salaryTable"></tbody></table>
  </div>

<script>
function fillEmployees() {
  fetch("/api/employees").then(res => res.json()).then(data => {
    const empSelects = [document.getElementById("employeeSelect"), document.getElementById("commissionEmployee")];
    empSelects.forEach(sel => {
      sel.innerHTML = "";
      data.forEach(emp => {
        const opt = document.createElement("option");
        opt.value = emp._id;
        opt.textContent = emp.name;
        sel.appendChild(opt);
      });
    });
    renderEmployees(data);
  });
}

document.getElementById("employeeForm").addEventListener("submit", e => {
  e.preventDefault();
  const data = {
    name: document.getElementById("empName").value,
    job: document.getElementById("empJob").value,
    salary: parseFloat(document.getElementById("empSalary").value)
  };
  fetch("/api/employees", {
    method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data)
  }).then(() => { fillEmployees(); e.target.reset(); });
});

function renderEmployees(data) {
  const tbody = document.getElementById("employeeTable");
  tbody.innerHTML = "";
  data.forEach(emp => {
    tbody.innerHTML += `<tr><td>${emp.name}</td><td>${emp.job}</td><td>${emp.salary}</td><td><button onclick="deleteEmployee('${emp._id}')">ğŸ—‘</button></td></tr>`;
  });
}

function deleteEmployee(id) {
  if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸ÙØŸ")) return;
  fetch("/api/employees/" + id, { method: "DELETE" }).then(() => fillEmployees());
}

document.getElementById("attendanceForm").addEventListener("submit", e => {
  e.preventDefault();
  const data = {
    employee: document.getElementById("employeeSelect").value,
    date: document.getElementById("attendanceDate").value,
    status: document.getElementById("statusSelect").value
  };
  fetch("/api/attendance", {
    method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data)
  }).then(() => loadAttendance());
});

function loadAttendance() {
  fetch("/api/attendance").then(res => res.json()).then(data => {
    const tbody = document.getElementById("attendanceTable");
    tbody.innerHTML = "";
    data.forEach(a => {
      tbody.innerHTML += `<tr><td>${a.employee?.name}</td><td>${a.date}</td><td>${a.status}</td></tr>`;
    });
  });
}

document.getElementById("commissionForm").addEventListener("submit", e => {
  e.preventDefault();
  const data = {
    employee: document.getElementById("commissionEmployee").value,
    amount: parseFloat(document.getElementById("commissionAmount").value),
    date: document.getElementById("commissionDate").value
  };
  fetch("/api/commissions", {
    method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data)
  }).then(() => loadCommissions());
});

function loadCommissions() {
  fetch("/api/commissions").then(res => res.json()).then(data => {
    const tbody = document.getElementById("commissionTable");
    tbody.innerHTML = "";
    data.forEach(c => {
      tbody.innerHTML += `<tr><td>${c.employee?.name}</td><td>${c.amount}</td><td>${c.date}</td></tr>`;
    });
  });
}

function calculateSalaries() {
  fetch("/api/salaries").then(res => res.json()).then(data => {
    const tbody = document.getElementById("salaryTable");
    tbody.innerHTML = "";
    data.forEach(s => {
      tbody.innerHTML += `<tr><td>${s.name}</td><td>${s.base}</td><td>${s.present}</td><td>${s.absent}</td><td>${s.commission}</td><td>${s.total}</td></tr>`;
    });
  });
}

window.onload = () => {
  fillEmployees();
  loadAttendance();
  loadCommissions();
};
</script>

<script src="/role-check.js"></script>
<script>protectPage(["admin", "hr"])</script>
</body>

</html>
