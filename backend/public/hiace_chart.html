
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø´Ø§Ø±Øª Ø§Ù„Ù‡Ø§ÙŠ Ø§Ø³ + ØªØ­ÙƒÙ…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f4f4f4; padding: 30px; text-align: center; }
    h3 { margin-bottom: 30px; }
    .seat { width: 50px; height: 50px; display: inline-block; margin: 6px; line-height: 50px; font-weight: bold;
            border-radius: 6px; cursor: pointer; border: 2px solid #ccc; font-size: 14px; }
    .available { background-color: #28a745; color: white; }
    .reserved { background-color: #dc3545; color: white; }
    #seatInfo { margin-top: 30px; text-align: right; background: #fff; padding: 20px; border-radius: 10px; display: none; box-shadow: 0 0 10px #ccc; }
    #seatInfo button { margin-top: 10px; margin-left: 10px; }
  </style>
</head>
<body>
  <h3>ğŸš Ø´Ø§Ø±Øª ÙƒØ±Ø§Ø³ÙŠ Ø§Ù„Ù‡Ø§ÙŠ Ø§Ø³ (14 ÙƒØ±Ø³ÙŠ)</h3>
  <div id="seatsContainer"></div>

  <div id="seatInfo">
    <h5>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²</h5>
    <p id="infoName">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: </p>
    <p id="infoPhone">ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: </p>
    <p id="infoCity">ğŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: </p>
    <p id="infoDate">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³ÙØ±: </p>
    <button class="btn btn-warning" onclick="editReservation()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²</button>
    <button class="btn btn-danger" onclick="deleteReservation()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²</button>
  </div>

<script>
const TOTAL_SEATS = 14;
let reservations = [];
let selectedReservationId = null;

function renderSeats() {
  const container = document.getElementById("seatsContainer");
  container.innerHTML = "";
  for (let i = 1; i <= TOTAL_SEATS; i++) {
    const seat = document.createElement("div");
    const found = reservations.find(r => r.seatNumber === i);
    seat.className = "seat " + (found ? "reserved" : "available");
    seat.innerText = i;
    seat.onclick = () => handleSeatClick(i);
    container.appendChild(seat);
    if (i % 2 === 0) container.appendChild(document.createElement("br"));
  }
}

function loadReservedSeats() {
  fetch("/api/reservations/hiace/today")
    .then(res => res.json())
    .then(data => {
      reservations = data;
      renderSeats();
    });
}

function handleSeatClick(seatNum) {
  const found = reservations.find(r => r.seatNumber === seatNum);
  if (found) {
    document.getElementById("seatInfo").style.display = "block";
    selectedReservationId = found._id;
    document.getElementById("infoName").innerText = "ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: " + (found.customer?.name || "--");
    document.getElementById("infoPhone").innerText = "ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: " + (found.customer?.phone || "--");
    document.getElementById("infoCity").innerText = "ğŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: " + (found.city || "--");
    document.getElementById("infoDate").innerText = "ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³ÙØ±: " + (found.travelDate || "--");
  } else {
    localStorage.setItem("seatNumber", seatNum);
    localStorage.setItem("transport", "Ù‡Ø§ÙŠ Ø§Ø³");
    window.location.href = "/add_reservation_direct.html";
  }
}

function editReservation() {
  if (!selectedReservationId) return;
  window.location.href = "/edit_invoice.html?id=" + selectedReservationId;
}

function deleteReservation() {
  if (!selectedReservationId || !confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ")) return;
  fetch("/api/reservations/" + selectedReservationId, { method: 'DELETE' })
    .then(() => {
      alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­");
      window.location.reload();
    });
}

window.onload = loadReservedSeats;
</script>
</body>
</html>
