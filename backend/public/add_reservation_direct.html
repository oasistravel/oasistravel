
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ุฅุถุงูุฉ ุญุฌุฒ ูุจุงุดุฑ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f9f9f9; padding: 30px; }
  </style>
</head>
<body>
  <div class="container bg-white p-4 rounded shadow">
    <h4 class="mb-4">๐ ุญุฌุฒ ูุฑุณู ูุงู ุงุณ ูุจุงุดุฑ</h4>

    <div class="mb-3">
      <label>ุงูุนููู:</label>
      <select id="customer" class="form-select"></select>
    </div>

    <div class="mb-3">
      <label>ุชุงุฑูุฎ ุงูุณูุฑ:</label>
      <input type="date" id="travelDate" class="form-control">
    </div>

    <div class="mb-3">
      <label>ุงููุฏููุฉ:</label>
      <input type="text" id="city" class="form-control">
    </div>

    <div class="mb-3">
      <label>ุนุฏุฏ ุงูุฃูุฑุงุฏ:</label>
      <input type="number" id="count" class="form-control" value="1">
    </div>

    <div class="mb-3">
      <label>ุงููุจูุบ ุงููุฏููุน:</label>
      <input type="number" id="paid" class="form-control">
    </div>

    <div class="mb-3">
      <label>ุฑูู ุงููุฑุณู:</label>
      <input type="number" id="seatNumber" class="form-control" readonly>
    </div>

    <div class="mb-3">
      <label>ูุณููุฉ ุงูููู:</label>
      <input type="text" id="transport" class="form-control" value="ูุงู ุงุณ" readonly>
    </div>

    <button class="btn btn-success" onclick="submitReservation()">๐พ ุญูุธ ุงูุญุฌุฒ</button>
  </div>

<script>
function loadCustomers() {
  fetch('/api/customers')
    .then(res => res.json())
    .then(data => {
      const customerSelect = document.getElementById("customer");
      data.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c._id;
        opt.text = c.name + " - " + (c.phone || '');
        customerSelect.appendChild(opt);
      });
    });
}

function prefillForm() {
  document.getElementById("seatNumber").value = localStorage.getItem("seatNumber") || '';
  document.getElementById("transport").value = localStorage.getItem("transport") || 'ูุงู ุงุณ';
}

function submitReservation() {
  const data = {
    customer: document.getElementById("customer").value,
    travelDate: document.getElementById("travelDate").value,
    city: document.getElementById("city").value,
    count: document.getElementById("count").value,
    paid: document.getElementById("paid").value,
    seatNumber: parseInt(document.getElementById("seatNumber").value),
    transport: document.getElementById("transport").value
  };

  fetch('/api/reservations', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  }).then(() => {
    alert("โ ุชู ุญูุธ ุงูุญุฌุฒ ุจูุฌุงุญ");
    window.location.href = "/hiace_chart.html";
  });
}

window.onload = () => {
  prefillForm();
  loadCustomers();
}
</script>

<script src="/role-check.js"></script>
<script>protectPage(['admin', 'sales']);</script>
</body>

</html>
